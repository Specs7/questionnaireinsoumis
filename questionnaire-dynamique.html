<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire Dynamique</title>
    <style>
        /* Charte graphique La France Insoumise */
        :root {
            --fi-red: #C9462C;
            --fi-dark-red: #A6341D;
            --fi-blue: #0098B6;
            --fi-dark-blue: #007A91;
            --fi-light-gray: #F2F2F2;
            --fi-dark-gray: #333333;
            --fi-purple: #75185B;
        }
        
        @font-face {
            font-family: 'Roboto';
            src: url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--fi-light-gray);
            color: var(--fi-dark-gray);
        }
        
        h1 {
            text-align: center;
            color: var(--fi-red);
            margin-bottom: 30px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        h2, h3 {
            color: var(--fi-purple);
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        select, input, button {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
        }
        
        button {
            background-color: var(--fi-red);
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 1px;
        }
        
        button:hover {
            background-color: var(--fi-dark-red);
        }
        
        button.secondary {
            background-color: var(--fi-blue);
        }
        
        button.secondary:hover {
            background-color: var(--fi-dark-blue);
        }
        
        .question {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--fi-light-gray);
            border-radius: 4px;
            border-left: 4px solid var(--fi-red);
        }
        
        .hidden {
            display: none;
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--fi-light-gray);
            border-radius: 4px;
            text-align: center;
        }
        
        .progress-container {
            margin: 20px 0;
            background-color: #e0e0e0;
            border-radius: 4px;
            height: 8px;
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: var(--fi-red);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input {
            width: auto;
            margin-right: 10px;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logo img {
            max-height: 80px;
        }
    </style>
</head>
<body>
    <nav>
        <ul style="display:flex; gap:20px; list-style:none; padding:0; margin-bottom:30px;">
            <li><a href="pourquoi-questionnaire.html">Pourquoi ce questionnaire ?</a></li>
            <li><a href="questionnaire-dynamique.html">Répondre au questionnaire</a></li>
        </ul>
    </nav>
    <div class="container">
        <div class="logo">
            <img src="/api/placeholder/180/80" alt="Logo La France Insoumise">
        </div>
        <h1>Questionnaire Citoyen</h1>
        
        <div id="initial-form">
            <div class="form-group">
                <label for="nom">Votre nom :</label>
                <input type="text" id="nom" required>
            </div>
            
            <div class="form-group">
                <label for="email">Votre adresse email :</label>
                <input type="email" id="email" required>
            </div>
            
            <div class="form-group">
                <label for="age">Votre âge :</label>
                <input type="number" id="age" min="18" max="120" required>
            </div>
            
            <div class="form-group">
                <label for="genre">Votre genre :</label>
                <select id="genre" required>
                    <option value="">Sélectionnez votre genre</option>
                    <option value="homme">Homme</option>
                    <option value="femme">Femme</option>
                    <option value="autre">Autre</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="quartier">Votre quartier :</label>
                <select id="quartier" required>
                    <option value="">Sélectionnez votre quartier</option>
                    <option value="avenir parisien">Avenir Parisien</option>
                    <option value="centre ville">Centre Ville</option>
                    <option value="economie">Economie</option>
                    <option value="la mare">La Mare</option>
                    <option value="la muette-quatre routes">La Muette-Quatre Routes</option>
                    <option value="les oiseaux">Les Oiseaux</option>
                    <option value="paris campagne">Paris Campagne</option>
                    <option value="petit drancy">Petit Drancy</option>
                    <option value="village parisien">Village Parisien</option>
                </select>
            </div>
            
            <div class="form-group" style="background:#f9f9f9; border-left:4px solid #C9462C; padding:12px; margin-bottom:16px;">
                <strong>Protection des données personnelles :</strong>
                <p>
                    Les informations recueillies dans ce questionnaire sont enregistrées par Drancy Insoumise pour analyse statistique et prise de contact si vous l’acceptez.<br>
                    Elles sont conservées pendant 1 an.<br>
                    Conformément à la loi « informatique et libertés » et au RGPD, vous pouvez exercer vos droits d’accès, de rectification ou de suppression des données vous concernant en contactant : <a href="mailto:contact@drancyinsoumise.org">contact@drancyinsoumise.org</a>.
                </p>
                <label>
                    <input type="checkbox" id="rgpd-consent" required>
                    J’ai lu et j’accepte la politique de confidentialité et le traitement de mes données personnelles.
                </label>
            </div>
            
            <button id="start-questionnaire">Commencer le questionnaire</button>
        </div>
        
        <div id="questionnaire" class="hidden">
            <div class="progress-container">
                <div class="progress-bar" id="progress"></div>
            </div>
            
            <div id="question-container"></div>
            
            <div class="form-group">
                <button id="next-question">Suivant</button>
                <button id="prev-question" class="hidden">Précédent</button>
                <button id="submit-questionnaire" class="hidden">Terminer</button>
            </div>
        </div>
        
        <div id="result-container" class="hidden result">
            <h2>Merci d'avoir complété le questionnaire !</h2>
            <p>Vos réponses ont été enregistrées.</p>
            
            <div class="form-group">
                <label for="contact-consent">
                    <input type="checkbox" id="contact-consent"> Souhaitez-vous être contacté(e) pour recevoir plus d'informations ?
                </label>
            </div>
            
            <button id="submit-final" class="secondary">Envoyer</button>
            <button id="restart">Recommencer</button>
        </div>
    </div>
    
    <script>
        // Définir les questions pour chaque catégorie
        const questions = {
            "18_25": [
                // Justice sociale
                { id: "js1", question: "Avez-vous rencontré des difficultés pour accéder à un emploi ou à une formation ?", type: "radio", options: ["Oui", "Non", "Ne sait pas"] },
                { id: "js2", question: "Pensez-vous que les aides sociales sont suffisantes pour les jeunes ?", type: "radio", options: ["Oui", "Non", "Ne sait pas"] },
                // Écologie
                { id: "eco1", question: "Seriez-vous favorable à plus d’espaces verts et de transports écologiques dans votre ville ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                { id: "eco2", question: "Êtes-vous prêt·e à participer à des actions collectives pour l’écologie (nettoyage, plantations, etc.) ?", type: "radio", options: ["Oui", "Non", "Peut-être"] },
                // Démocratie populaire
                { id: "dp1", question: "Aimeriez-vous que les jeunes soient davantage consultés sur les décisions locales ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                { id: "dp2", question: "Seriez-vous intéressé·e par des assemblées citoyennes pour débattre des projets de la ville ?", type: "radio", options: ["Oui", "Non", "Peut-être"] }
            ],
            "26_35": [
                // Justice sociale
                { id: "js1", question: "Avez-vous rencontré des obstacles pour accéder au logement ou à l’emploi stable ?", type: "radio", options: ["Oui", "Non", "Ne sait pas"] },
                { id: "js2", question: "Les services publics (santé, crèche, école) répondent-ils à vos besoins ?", type: "radio", options: ["Oui", "Non", "Partiellement"] },
                // Écologie
                { id: "eco1", question: "Seriez-vous favorable à des mesures ambitieuses pour réduire la pollution dans votre quartier ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                { id: "eco2", question: "Seriez-vous prêt·e à privilégier les mobilités douces (vélo, marche, transports en commun) ?", type: "radio", options: ["Oui", "Non", "Déjà fait"] },
                // Démocratie populaire
                { id: "dp1", question: "Souhaitez-vous participer à des consultations citoyennes sur les projets municipaux ?", type: "radio", options: ["Oui", "Non", "Peut-être"] },
                { id: "dp2", question: "Pensez-vous que la démocratie locale devrait être renforcée (référendums, budgets participatifs) ?", type: "radio", options: ["Oui", "Non", "Sans avis"] }
            ],
            "36_50": [
                // Justice sociale
                { id: "js1", question: "Avez-vous constaté des inégalités d’accès aux soins ou à l’éducation dans votre entourage ?", type: "radio", options: ["Oui", "Non", "Ne sait pas"] },
                { id: "js2", question: "Les politiques sociales actuelles protègent-elles suffisamment les familles ?", type: "radio", options: ["Oui", "Non", "Partiellement"] },
                // Écologie
                { id: "eco1", question: "Faut-il renforcer la lutte contre les pollutions industrielles et urbaines ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                { id: "eco2", question: "Seriez-vous prêt·e à soutenir des initiatives locales pour la transition écologique ?", type: "radio", options: ["Oui", "Non", "Peut-être"] },
                // Démocratie populaire
                { id: "dp1", question: "Pensez-vous que les citoyens devraient pouvoir proposer des lois localement ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                { id: "dp2", question: "Aimeriez-vous participer à des réunions publiques pour débattre des choix municipaux ?", type: "radio", options: ["Oui", "Non", "Peut-être"] }
            ],
            "51_60": [
                // Justice sociale
                { id: "js1", question: "Avez-vous rencontré des difficultés dans l’accès à la santé ou à la retraite ?", type: "radio", options: ["Oui", "Non", "Ne sait pas"] },
                { id: "js2", question: "Les dispositifs de solidarité sont-ils adaptés aux besoins des personnes de votre âge ?", type: "radio", options: ["Oui", "Non", "Partiellement"] },
                // Écologie
                { id: "eco1", question: "Faut-il investir davantage dans la rénovation énergétique des logements ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                { id: "eco2", question: "Seriez-vous prêt·e à participer à des démarches collectives pour l’écologie (jardins partagés, recyclage, etc.) ?", type: "radio", options: ["Oui", "Non", "Peut-être"] },
                // Démocratie populaire
                { id: "dp1", question: "Souhaitez-vous être davantage consulté·e sur les politiques locales concernant les seniors ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                { id: "dp2", question: "Pensez-vous que la démocratie participative peut améliorer la vie locale ?", type: "radio", options: ["Oui", "Non", "Sans avis"] }
            ],
            "60_plus": [
                // Justice sociale
                { id: "js1", question: "Avez-vous accès facilement aux soins et aux services publics ?", type: "radio", options: ["Oui", "Non", "Partiellement"] },
                { id: "js2", question: "Les pensions de retraite vous semblent-elles suffisantes pour vivre dignement ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                // Écologie
                { id: "eco1", question: "Faut-il renforcer les actions pour préserver l’environnement pour les générations futures ?", type: "radio", options: ["Oui", "Non", "Sans avis"] },
                { id: "eco2", question: "Seriez-vous prêt·e à soutenir des projets écologiques portés par la commune ?", type: "radio", options: ["Oui", "Non", "Peut-être"] },
                // Démocratie populaire
                { id: "dp1", question: "Souhaitez-vous participer à des conseils de quartier ou des assemblées citoyennes ?", type: "radio", options: ["Oui", "Non", "Peut-être"] },
                { id: "dp2", question: "Pensez-vous que les élus locaux sont à l’écoute des habitants ?", type: "radio", options: ["Oui", "Non", "Parfois"] }
            ]
        };

        // Variables globales
        let currentCategory = "";
        let currentQuestionIndex = 0;
        let userResponses = {};
        let userData = {
            nom: "",
            email: "",
            age: null,
            genre: "",
            quartier: "",
            contactConsent: false
        };
        
        // Éléments du DOM
        const initialForm = document.getElementById('initial-form');
        const questionnaireSection = document.getElementById('questionnaire');
        const questionContainer = document.getElementById('question-container');
        const nextButton = document.getElementById('next-question');
        const prevButton = document.getElementById('prev-question');
        const submitButton = document.getElementById('submit-questionnaire');
        const resultContainer = document.getElementById('result-container');
        const progressBar = document.getElementById('progress');
        
        // Démarrer le questionnaire
        document.getElementById('start-questionnaire').addEventListener('click', function() {
            const nom = document.getElementById('nom').value.trim();
            const email = document.getElementById('email').value.trim();
            const age = parseInt(document.getElementById('age').value);
            const genre = document.getElementById('genre').value;
            const quartier = document.getElementById('quartier').value;
            
            if (!nom || !email || !age || !genre || !quartier) {
                alert("Veuillez remplir tous les champs.");
                return;
            }
            
            if (!document.getElementById('rgpd-consent').checked) {
                alert("Vous devez accepter la politique de confidentialité pour continuer.");
                return;
            }
            
            // Validation de l'email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert("Veuillez entrer une adresse email valide.");
                return;
            }
            
            if (age < 18 || age > 120) {
                alert("L'âge doit être compris entre 18 et 120 ans.");
                return;
            }
            
            // Enregistrer les données utilisateur
            userData.nom = nom;
            userData.email = email;
            userData.age = age;
            userData.genre = genre;
            userData.quartier = quartier;
            
            // Déterminer la catégorie
            let ageGroup = "";
            if (age >= 18 && age <= 25) ageGroup = "18_25";
            else if (age >= 26 && age <= 35) ageGroup = "26_35";
            else if (age >= 36 && age <= 50) ageGroup = "36_50";
            else if (age >= 51 && age <= 60) ageGroup = "51_60";
            else if (age > 60) ageGroup = "60_plus";
            currentCategory = ageGroup;
            
            // Cacher le formulaire initial et afficher le questionnaire
            initialForm.classList.add('hidden');
            questionnaireSection.classList.remove('hidden');
            
            // Afficher la première question
            displayQuestion(0);
        });
        
        // Afficher une question
        function displayQuestion(index) {
            // Mise à jour de l'index de la question courante
            currentQuestionIndex = index;
            
            // Vérifier si nous avons des questions pour cette catégorie
            if (!questions[currentCategory] || !questions[currentCategory][index]) {
                console.error(`Pas de questions pour la catégorie ${currentCategory} à l'index ${index}`);
                return;
            }
            
            // Récupérer la question
            const question = questions[currentCategory][index];
            
            // Créer l'élément HTML pour la question
            let questionHTML = `
                <div class="question">
                    <h3>${index + 1}. ${question.question}</h3>
            `;
            
            // Ajouter les options selon le type de question
            if (question.type === "radio") {
                questionHTML += `<div class="radio-group">`;
                question.options.forEach((option, i) => {
                    const checked = userResponses[question.id] === option ? "checked" : "";
                    questionHTML += `
                        <div class="radio-option">
                            <input type="radio" id="${question.id}_${i}" name="${question.id}" value="${option}" ${checked}>
                            <label for="${question.id}_${i}">${option}</label>
                        </div>
                    `;
                });
                questionHTML += `</div>`;
            }
            
            questionHTML += `</div>`;
            
            // Mettre à jour le contenu
            questionContainer.innerHTML = questionHTML;
            
            // Mettre à jour la progression
            updateProgress();
            
            // Mettre à jour les boutons
            updateButtons();
        }
        
        // Mettre à jour la barre de progression
        function updateProgress() {
            const totalQuestions = questions[currentCategory].length;
            const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        // Mettre à jour l'état des boutons
        function updateButtons() {
            const totalQuestions = questions[currentCategory].length;
            
            // Bouton précédent
            if (currentQuestionIndex > 0) {
                prevButton.classList.remove('hidden');
            } else {
                prevButton.classList.add('hidden');
            }
            
            // Bouton suivant et terminer
            if (currentQuestionIndex === totalQuestions - 1) {
                nextButton.classList.add('hidden');
                submitButton.classList.remove('hidden');
            } else {
                nextButton.classList.remove('hidden');
                submitButton.classList.add('hidden');
            }
        }
        
        // Sauvegarder la réponse actuelle
        function saveCurrentResponse() {
            const currentQuestion = questions[currentCategory][currentQuestionIndex];
            
            if (currentQuestion.type === "radio") {
                const selectedOption = document.querySelector(`input[name="${currentQuestion.id}"]:checked`);
                if (selectedOption) {
                    userResponses[currentQuestion.id] = selectedOption.value;
                }
            }
        }
        
        // Événement pour le bouton suivant
        nextButton.addEventListener('click', function() {
            saveCurrentResponse();
            
            const currentQuestion = questions[currentCategory][currentQuestionIndex];
            if (currentQuestion.type === "radio" && !userResponses[currentQuestion.id]) {
                alert("Veuillez sélectionner une réponse avant de continuer.");
                return;
            }
            
            displayQuestion(currentQuestionIndex + 1);
        });
        
        // Événement pour le bouton précédent
        prevButton.addEventListener('click', function() {
            saveCurrentResponse();
            displayQuestion(currentQuestionIndex - 1);
        });
        
        // Événement pour le bouton terminer
        submitButton.addEventListener('click', function() {
            saveCurrentResponse();
            
            const currentQuestion = questions[currentCategory][currentQuestionIndex];
            if (currentQuestion.type === "radio" && !userResponses[currentQuestion.id]) {
                alert("Veuillez sélectionner une réponse avant de terminer.");
                return;
            }
            
            // Afficher le résultat
            questionnaireSection.classList.add('hidden');
            resultContainer.classList.remove('hidden');
            
            // Ici, vous pourriez envoyer les données à un serveur
            console.log("Informations utilisateur:", userData);
            console.log("Réponses de l'utilisateur:", userResponses);
        });
        
        // Événement pour envoyer les données finales
        document.getElementById('submit-final').addEventListener('click', function() {
            // Récupérer le consentement
            userData.contactConsent = document.getElementById('contact-consent').checked;

            // Construire les données à envoyer
            const formData = {
                nom: userData.nom,
                email: userData.email,
                age: userData.age,
                genre: userData.genre,
                quartier: userData.quartier,
                contactConsent: userData.contactConsent ? "Oui" : "Non",
                ...userResponses
            };

            // Envoi à Formspree
            fetch('https://formspree.io/f/mblopyro/', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (response.ok) {
                    alert("Vos réponses ont été envoyées. Merci de votre participation !");
                } else {
                    alert("Une erreur est survenue lors de l'envoi. Merci de réessayer.");
                }
            })
            .catch(() => {
                alert("Une erreur réseau est survenue.");
            });
        });
        
        // Événement pour recommencer
        document.getElementById('restart').addEventListener('click', function() {
            // Réinitialiser les variables
            currentCategory = "";
            currentQuestionIndex = 0;
            userResponses = {};
            userData = {
                nom: "",
                email: "",
                age: null,
                genre: "",
                quartier: "",
                contactConsent: false
            };
            
            // Réinitialiser l'interface
            resultContainer.classList.add('hidden');
            initialForm.classList.remove('hidden');
            document.getElementById('nom').value = "";
            document.getElementById('email').value = "";
            document.getElementById('age').value = "";
            document.getElementById('genre').value = "";
            document.getElementById('quartier').value = "";
            document.getElementById('contact-consent').checked = false;
        });
    </script>
</body>
</html>